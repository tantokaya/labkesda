$(document).ready(function(){function a(){$("input:radio[name=tipe_arsip][value=1]").prop("checked",!0),$("input:radio[name=jenis_arsip][value=0]").prop("checked",!0),$("#frm-add").find("input[type=text],textarea").val(""),$(".fileinput-remove").click(),$("div.file").show(),$("div.folder").hide(),$("#simpan-arsip").hide()}oTable=$("#tbl-arsip").dataTable({bProcessing:!0,bServerSide:!0,sAjaxSource:baseUrl+"arsip/dt_arsip_saya",order:[[0,"asc"]],bAutoWidth:!1,sPaginationType:"full_numbers",bSort:!0,dom:'<"datatable-header"fl><"datatable-scroll-lg"t><"datatable-footer"ip>',language:{search:"<span>Pencarian:</span> _INPUT_",lengthMenu:"<span>Show:</span> _MENU_",paginate:{first:"Pertama",last:"Terakhir",next:"&rarr;",previous:"&larr;"}},lengthMenu:[10,25,50,75,100],fnInitComplete:function(){},columns:[{data:"kode",sName:"kode",bVisible:!1,bSearchable:!1},{data:"arsip",sName:"arsip",width:"35%",render:function(a,b,c){var d;return d="display"==b?"0"==c.jenis_arsip?'<a href="javascript:void(0)" class="file text-info" onclick="window.open(\''+fspath+c.unit_kerja_id+"/"+c.filename+"','_blank');\"><i class=\"icon icon-file-empty\"></i>&nbsp;&nbsp;&nbsp;"+a+"</a>":'<a href="javascript:void(0)" class="folder text-info" data-parent="'+c.kode+'" data-level="'+(parseInt(c.level)+1)+'"><i class="icon icon-folder-open"></i>&nbsp;&nbsp;&nbsp;'+a+"</a>":a}},{data:"deskripsi",sName:"deskripsi",width:"15%"},{data:"is_public",sName:"is_public",class:"text-center",width:"1%",render:function(a,b,c){var d;return d="0"==a?'<i class="icon-lock"></i>':'<i class="icon-earth"></i>'}},{data:"created",sName:"created",width:"15%"},{data:"modified",sName:"modified",width:"15%"},{data:"aksi",class:"text-center",sWidth:"5%",render:function(a,b,c){var d;if(c.user_id!==user_id){var e=$(c.aksi);e.find("ul.action_menu li:not(:first)").remove(),d='<ul class="icons-list">'+e.html()+"</ul>"}else{var e=$(c.aksi),f="1"==c.is_public?'<i class="icon-lock"></i> Ubah Ke Arsip Saya':'<i class="icon-earth"></i> Ubah Ke Arsip Publik';e.find("ul.action_menu li:nth-child(3) a").html(f),d='<ul class="icons-list">'+e.html()+"</ul>"}return d}}],aoColumnDefs:[{bSortable:!1,bSearchable:!1,aTargets:[-1]}],fnServerData:function(a,b,c){b.push({name:"level",value:$("#level").val()}),b.push({name:"parent",value:$("#parent").val()}),$.ajax({dataType:"json",type:"POST",url:a,data:b,success:c})}}),$(".dataTables_filter input[type=search]").attr("placeholder","Pencarian..."),$(".dataTables_length select").select2({minimumResultsForSearch:1/0,width:"60px"}),$("#tbl-arsip").delegate("a.folder","click",function(a){a.preventDefault();var b=$(this),c=$("#path").val();$("#level").val(b.data("level")),$("#parent").val(b.data("parent")),$("#path").val(c+","+b.data("parent")),b.data("level")==lvl?$("#btn-up").hide():$("#btn-up").show(),oTable._fnAjaxUpdate()}).delegate("a.rename-arsip","click",function(a){var b=$(this);a.preventDefault(),$("#rename_id").val(b.data("id")),$("#rename").val(b.data("nama")),$("#mdl_rename").modal("show")}).delegate("a.detail-arsip","click",function(a){var b=$(this);a.preventDefault(),$.ajax({type:"POST",data:{id:b.data("id")},url:baseUrl+"arsip/detail",success:function(a){$("#mdl_detail").find(".modal-body").html(a),$("#mdl_detail").modal("show")}})}).delegate("a.hapus-arsip","click",function(a){var b=$(this);a.preventDefault(),swal({title:"Konfirmasi Hapus Data",text:"Apakah anda yakin ingin menghapus data ini?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Hapus",cancelButtonText:"Batal",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?$.ajax({type:"POST",dataType:"json",url:baseUrl+"arsip/delete",data:{id:b.data("id"),jenis:b.data("jenis-arsip"),level:$("#level").val()},success:function(a){oTable._fnAjaxUpdate(),swal(a.message,"",a.type)}}):swal("Batal","Hapus data dibatalkan","error")})}).delegate("a.change-arsip","click",function(a){var b=$(this);a.preventDefault(),swal({title:"Konfirmasi Ubah Data",text:"Apakah anda yakin ingin mengubah arsip ini menjadi arsip saya?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Ubah",cancelButtonText:"Batal",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?$.ajax({type:"POST",dataType:"json",url:baseUrl+"arsip/change",data:{id:b.data("id"),publik:b.data("publik")},success:function(a){oTable._fnAjaxUpdate(),swal(a.message,"",a.type)}}):swal("Batal","Ubah data dibatalkan","error")})}),$("#btn-add").on("click",function(a){$("#mdl_add").modal("show")}),$("#btn-home").on("click",function(a){a.preventDefault();var b=$(this).data();$("#level").val(b.level),$("#parent").val(b.parent),$("#path").val(b.path),$("#level").val()==lvl?$("#btn-up").hide():$("#btn-up").show(),oTable._fnAjaxUpdate()}),$("#mdl_add").on("show.bs.modal",function(a){$("#curr_level").val($("#level").val()),$("#curr_parent").val($("#parent").val())}),$("#mdl_add").on("hidden.bs.modal",function(b){a()}),$("#tbl-arsip").delegate("a.btn-delete","click",function(a){a.preventDefault();var b=$(this).data("id");swal({title:"Konfirmasi Hapus Data",text:"Apakah anda yakin ingin menghapus data ini?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Hapus",cancelButtonText:"Batal",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?$.ajax({type:"POST",dataType:"json",url:baseUrl+"arsip/delete",data:{id:b},success:function(a){oTable._fnAjaxUpdate(),swal(a.message,"",a.type)}}):swal("Batal","Hapus data dibatalkan","error")})})}),$(function(){$("#level").val()==lvl?$("#btn-up").hide():$("#btn-up").show(),$("#btn-up").on("click",function(a){a.preventDefault();var b=parseInt($("#level").val()),c=$("#path").val(),d=c.split(","),e=d[b-1];if($("#level").val(b-1),$("#parent").val(e),$("#level").val()==lvl)$("#path").val(pth),$("#parent").val(prn),$("#btn-up").hide();else{var f=c.lastIndexOf(","),g=c.substring(0,f);$("#path").val(g),$("#btn-up").show()}oTable._fnAjaxUpdate()}),$("input[type=radio][name=jenis_arsip]").change(function(){"1"==this.value?($("div.file").hide(),$("div.folder").show(),$("#simpan-arsip").show()):"0"==this.value&&($("div.folder").hide(),$("div.file").show(),$("#simpan-arsip").hide())}),$("#simpan-arsip").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",dataType:"json",data:{parent:$("#curr_parent").val(),level:$("#curr_level").val(),tipe_arsip:$("input[name=tipe_arsip]:checked").val(),nm_folder:$("#nm_folder").val(),deskripsi:$("#deskripsi").val()},url:$("#frm-add").attr("action"),success:function(a){1==a.error?new PNotify({title:"Error!",text:a.message,addclass:"bg-danger"}):($("#mdl_add").modal("hide"),oTable._fnAjaxUpdate(),new PNotify({title:"Sukses!",text:a.message,addclass:"bg-success"}))}})}),$("#simpan-rename").on("click",function(a){a.preventDefault(),$.ajax({type:"POST",dataType:"json",data:{id:$("#rename_id").val(),arsip:$("#rename").val()},url:baseUrl+"arsip/rename",success:function(a){1==a.error?new PNotify({title:"Error!",text:a.message,addclass:"bg-danger"}):($("#mdl_rename").modal("hide"),oTable._fnAjaxUpdate(),new PNotify({title:"Sukses!",text:a.message,addclass:"bg-success"}))}})}),$("#lampiran").fileinput({uploadUrl:baseUrl+"arsip/upload_file",uploadAsync:!1,minFileCount:1,maxFileCount:5,uploadExtraData:function(){var a={};return a.parent=$("#curr_parent").val(),a.level=$("#curr_level").val(),a.is_public=$("input[name=tipe_arsip]:checked").val(),a},showPreview:!1,allowedFileExtensions:["jpg","png","xls","xlsx","pdf","ppt","pptx","doc","docx"],elErrorContainer:"#kv-error-2"}).on("filebatchpreupload",function(a,b,c,d){$("#kv-success-2").html("<h4>Status Upload</h4><ul></ul>").hide()}).on("filebatchuploadsuccess",function(a,b){var c="";$.each(b.files,function(a,b){var d=b.name;c=c+"<li>File terupload file # "+(a+1)+" - "+d+" dengan sukses.</li>"}),$("#kv-success-2 ul").append(c),$("#kv-success-2").fadeIn("slow"),$("#mdl_add").modal("hide"),oTable._fnAjaxUpdate()})});